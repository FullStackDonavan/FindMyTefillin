generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]
  binaryTargets   = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//datasource db {
//  provider  = "postgresql"
//  url       = env("fmt_PRISMA_URL")
//  directUrl = env("fmt_URL_NON_POOLING")
//}

enum TefillinStatus {
  unclaimed
  lost
  found
  foundButLost
}

model User {
  id                   Int                  @id @default(autoincrement())
  loginType            String?              @default("email")
  password             String?
  email                String?              @unique
  firstName            String?
  lastName             String?
  username             String?              @unique
  phone                String?              @unique
  
  avatar               String? // Field for storing avatar URL
  session              Session[]
  stripeCustomerId     String?
  Subscription         Subscription[]
  posts                Post[]

  photos               Photo[] // Define the relationship with the Photo model
  lostTefillinReports  LostTefillinReport[]
  registeredTefillin   RegisteredTefillin[]
  foundPosts           FoundPost[]
}

model RegisteredTefillin {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      Int

  idTag       String   @unique
  qrAttached  Boolean
  description String?
  photoUrl    String?
  status      String   @default("active")
  createdAt   DateTime @default(now())

  lostReports LostTefillinReport[] @relation("TefillinReports") 
  foundPosts  FoundPost[]
}

model FoundPost {
  id                         Int      @id @default(autoincrement())
  userId                     Int
  user                       User     @relation(fields: [userId], references: [id])
  idTag                      String
  location                   String
  photoUrl                   String?
  matchedRegisteredTefillinId Int?   
  matchedRegisteredTefillin  RegisteredTefillin? @relation(fields: [matchedRegisteredTefillinId], references: [id])
  status                     TefillinStatus @default(unclaimed)
  createdAt                  DateTime @default(now())
}


model Session {
  id        Int       @id @default(autoincrement())
  authToken String    @unique
  user      User      @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Post {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id])
  type           String // Type of post: 'text', 'video', 'meme', etc.
  content        Json // Store content data (e.g., video details for video posts)
  createdAt      DateTime @default(now())

  photos    Photo[] // Relation to Photo model
}

model LostTefillinReport {
  id                   Int                 @id @default(autoincrement())
  userId               Int
  user                 User                @relation(fields: [userId], references: [id])
  registeredTefillinId Int?
  registeredTefillin   RegisteredTefillin? @relation("TefillinReports", fields: [registeredTefillinId], references: [id]) // ðŸ‘ˆ Add relation name

  idTag          String
  registered     Boolean
  qrAttached     Boolean
  firstName      String
  lastName       String
  phone          String
  alternatePhone String?
  email          String
  location       String
  photoUrl       String?
  createdAt      DateTime @default(now())
}





model Photo {
  id        Int      @id @default(autoincrement())
  userId    Int
  postId    Int? // Optional: Link to Post
  url       String?  @db.Text
  createdAt DateTime @default(now())

  user User  @relation(fields: [userId], references: [id])
  post Post? @relation(fields: [postId], references: [id]) // Optional relation to a post
}


model Subscription {
  id            Int       @id @default(autoincrement())
  user          User      @relation(fields: [userId], references: [id])
  userId        Int
  stripeId      String    @unique
  stripeStatus  String?
  stripePriceId String?
  quantity      Int?
  trialEndsAt   DateTime?
  endsAt        DateTime?
  startDate     DateTime
  lastEventDate DateTime
}

